<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<title>ğŸš€ Ø³Ø§Ù…Ø§Ù†Ù‡ Ù‡ÙˆØ´Ù…Ù†Ø¯ Ø¢Ù…ÙˆØ²Ø´ ÙØ§Ø±Ø³ÛŒ Ø´Ø´Ù…</title>
<style>
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: 'Vazirmatn', 'Tahoma', sans-serif;
  }

  body {
    background: radial-gradient(circle at 50% 30%, #001d3d, #000814);
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 8px;
  }

  .main-card {
    width: 100%;
    max-width: 780px;
    background: rgba(20, 30, 45, 0.75);
    backdrop-filter: blur(20px);
    border-radius: 60px;
    border: 4px solid #ffbd33;
    padding: 20px;
  }
  
  .badge-container {
  display: flex;
  align-items: center;
  gap: 10px;
  background: #ffb700;
  border-radius: 50px;
  padding: 5px;
  box-shadow: 0 5px 0 #9b6500;
}

    .music-icon-btn {
    background: #001d3d;
    border: 3px solid #ffbd33;
    border-radius: 50px;
    width: 50px;
    height: 50px;
    font-size: 1.8rem;
    cursor: pointer;
    color: #ffbd33;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: 0.1s;
    box-shadow: 0 4px 0 #000814;
    }

    .music-icon-btn:active {
    transform: translateY(4px);
    box-shadow: 0 1px 0 #000814;
    }

  header {
    background: linear-gradient(135deg, #002b4a, #001d3d);
    border-radius: 50px 50px 20px 20px;
    padding: 18px;
    border: 3px solid #ffb700;
    color: white;
    text-align: center;
    margin-bottom: 20px;
  }

  header h2 {
    font-size: 2.2rem;
    text-shadow: 3px 3px 0 #000814;
  }

  .badge {
    background: #ffb700;
    color: #001d3d;
    padding: 8px 22px;
    border-radius: 50px;
    font-weight: 900;
    display: inline-block;
    margin-top: 10px;
    box-shadow: 0 5px 0 #9b6500;
  }

  .intro-panel {
    background: linear-gradient(145deg, #002b4a, #001a33);
    border-radius: 50px;
    padding: 30px;
    border: 5px solid #ffb700;
    color: white;
    text-align: center;
  }

  .intro-title {
    font-size: 2rem;
    color: #ffbd33;
    margin-bottom: 20px;
  }

  .intro-text {
    font-size: 1.2rem;
    line-height: 2;
    text-align: right;
    margin-bottom: 25px;
  }

  .intro-btn, .dialog-btn, .action-btn, .restart-btn {
    background: #ffb700;
    border: none;
    border-radius: 80px;
    padding: 12px 30px;
    font-size: 1.3rem;
    font-weight: 900;
    border-bottom: 5px solid #9b5e00;
    cursor: pointer;
    color: #001d3d;
    margin: 10px;
    transition: 0.1s;
  }

  .action-btn:active, .restart-btn:active, .intro-btn:active, .dialog-btn:active {
    transform: translateY(4px);
    border-bottom-width: 2px;
  }

  .rule-banner {
    background: linear-gradient(90deg, #ffb700, #ff9500);
    color: #001d3d;
    padding: 14px;
    border-radius: 60px;
    margin-bottom: 20px;
    display: flex;
    justify-content: center;
    gap: 20px;
    flex-wrap: wrap;
  }

  .rule-item {
    display: flex;
    align-items: center;
    gap: 8px;
    background: rgba(255,255,255,0.3);
    padding: 5px 15px;
    border-radius: 40px;
  }

  .custom-dialog {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.85);
    backdrop-filter: blur(12px);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 2000;
    padding: 20px;
  }

  .dialog-box {
    background: linear-gradient(145deg, #003566, #001d3d);
    border: 5px solid #ffb700;
    border-radius: 70px;
    padding: 35px;
    max-width: 480px;
    width: 100%;
    color: white;
    text-align: center;
  }

  .dialog-input {
    width: 100%;
    padding: 15px;
    font-size: 1.3rem;
    border-radius: 80px;
    border: 4px solid #ffb700;
    margin: 20px 0;
    text-align: right;
  }

  .launch-pad {
    background: rgba(0,5,15,0.98);
    border-radius: 60px;
    padding: 30px;
    border: 4px solid #ffb703;
    text-align: center;
    min-height: 450px;
  }

  #countdown {
    font-size: 8rem;
    color: #ffd966;
    text-shadow: 0 0 40px red;
    margin-bottom: 30px;
  }

  .balloon-container {
    display: flex;
    justify-content: center;
    margin: 30px 0;
    height: 250px;
  }

  .balloon-house {
    position: relative;
    width: 200px;
    height: 200px;
    cursor: pointer;
    animation: float 3s infinite ease-in-out;
  }

  @keyframes float {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-15px); }
  }

  @keyframes poof {
    0% { transform: scale(1); opacity: 1; }
    50% { transform: scale(1.3); opacity: 0.7; }
    100% { transform: scale(0); opacity: 0; }
  }

  .balloon-poof {
    animation: poof 0.5s ease-out forwards !important;
  }

  .balloon {
    position: absolute;
    width: 100%;
    height: 100%;
    filter: drop-shadow(0 20px 15px rgba(255, 215, 0, 0.4));
  }

  .balloon-main {
    position: absolute;
    width: 90%;
    height: 70%;
    background: radial-gradient(circle at 30% 30%, #ff6b6b, #ff3838);
    border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
    top: 0;
    left: 5%;
    box-shadow: 0 10px 0 #c41e1e;
    border: 4px solid #ffd966;
  }

  .balloon-shine {
    position: absolute;
    width: 25%;
    height: 20%;
    background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.8), rgba(255,255,255,0.2));
    border-radius: 50%;
    top: 15%;
    left: 20%;
  }

  .balloon-basket {
    position: absolute;
    width: 40%;
    height: 15%;
    background: linear-gradient(135deg, #8b4513, #5d3a1a);
    bottom: -5%;
    left: 30%;
    border-radius: 10px 10px 20px 20px;
    border: 3px solid #ffb700;
    box-shadow: 0 8px 0 #3e280e;
  }

  .balloon-ropes {
    position: absolute;
    width: 4px;
    height: 40px;
    background: #ffd966;
    bottom: 15%;
    left: 50%;
    transform: translateX(-50%);
    box-shadow: -15px 0 0 #ffd966, 15px 0 0 #ffd966;
  }

  .stars {
    position: absolute;
    width: 100%;
    height: 100%;
    pointer-events: none;
  }

  .star {
    position: absolute;
    background: white;
    border-radius: 50%;
    animation: twinkle 1.5s infinite alternate;
  }

  @keyframes twinkle {
    from { opacity: 0.2; transform: scale(1); }
    to { opacity: 1; transform: scale(1.8); }
  }

  .game-panel {
    background: rgba(0,20,40,0.85);
    backdrop-filter: blur(15px);
    border-radius: 50px;
    padding: 20px;
    border: 4px solid #ffc300;
  }

  .score-row {
    display: flex;
    justify-content: space-between;
    background: #001d3d;
    padding: 15px;
    border-radius: 50px;
    border: 3px solid #ffb703;
    color: white;
    font-size: 1.4rem;
  }

  .player-badge {
    background: #ffb703;
    color: black;
    padding: 5px 15px;
    border-radius: 40px;
  }

  .info-bar {
    display: flex;
    justify-content: space-between;
    background: #003566;
    border-radius: 50px;
    padding: 12px 20px;
    margin: 15px 0;
    border: 2px solid gold;
    color: white;
    font-size: 1.5rem;
  }

  .question-counter {
    background: #000814;
    padding: 10px;
    border-radius: 50px;
    color: #ffd966;
    text-align: center;
    margin-bottom: 15px;
    font-size: 1.2rem;
  }

  .question-card {
    background: linear-gradient(145deg, #fbefc7, #f6c445);
    border: 6px solid #ff9500;
    border-radius: 60px 60px 20px 20px;
    padding: 30px 15px;
    font-size: 1.8rem;
    font-weight: 900;
    color: #001d3d;
    text-align: center;
    margin-bottom: 20px;
  }

  .answer-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 12px;
    margin-bottom: 20px;
  }

  .answer-option {
    background: linear-gradient(to bottom, #ffda73, #e09d00);
    border: 4px solid #fff2b5;
    border-radius: 70px;
    padding: 18px;
    font-size: 1.3rem;
    font-weight: 800;
    color: #021f3b;
    box-shadow: 0 7px 0 #964b00;
    cursor: pointer;
    text-align: center;
    min-height: 90px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: 0.1s;
  }

  .answer-option:active {
    transform: translateY(6px);
    box-shadow: 0 1px 0 #964b00;
  }
  
  .answer-option.correct-selected {
    background: #2ecc71 !important;
    border-color: #27ae60 !important;
    color: white !important;
    box-shadow: 0 6px 0 #1e8449 !important;
  }
  
  .answer-option.wrong-selected {
    background: #e74c3c !important;
    border-color: #c0392b !important;
    color: white !important;
    box-shadow: 0 6px 0 #a93226 !important;
  }
  
  .answer-option.correct-answer-highlight {
    background: #2ecc71 !important;
    border-color: #27ae60 !important;
    color: white !important;
    box-shadow: 0 6px 0 #1e8449 !important;
  }
  
  .answer-option.disabled {
    pointer-events: none;
    opacity: 0.9;
  }

  #feedback {
    font-size: 1.5rem;
    background: #001d3d;
    border-radius: 60px;
    color: white;
    text-align: center;
    padding: 15px;
    border: 3px solid #ffaa00;
    min-height: 80px;
  }

  .result-panel {
    background: #000c1ab3;
    backdrop-filter: blur(20px);
    border-radius: 60px;
    padding: 30px;
    border: 6px solid #ffbb00;
    color: white;
    text-align: center;
  }

  .report-card {
    background: #001d3d;
    border: 4px solid #ffb700;
    border-radius: 40px;
    padding: 20px;
    margin: 20px 0;
    text-align: right;
  }

  .report-title {
    font-size: 1.8rem;
    color: #ffbd33;
    text-align: center;
    margin-bottom: 20px;
  }

  .report-stats {
    display: flex;
    justify-content: space-around;
    background: rgba(0,0,0,0.3);
    padding: 15px;
    border-radius: 30px;
    margin-bottom: 20px;
  }

  .stat-value {
    font-size: 2rem;
    font-weight: bold;
    color: #ffbd33;
  }

  .question-review {
    max-height: 300px;
    overflow-y: auto;
    padding: 10px;
    background: rgba(0,0,0,0.3);
    border-radius: 20px;
  }

  .review-item {
    padding: 10px;
    margin: 5px 0;
    border-radius: 10px;
    background: rgba(255,255,255,0.1);
    border-right: 5px solid;
  }

  .review-item.correct { border-right-color: #2ecc71; }
  .review-item.wrong { border-right-color: #e74c3c; }

  .hidden { display: none; }

  .confetti-particle {
    position: fixed;
    width: 10px;
    height: 10px;
    top: -20px;
    animation: fall 2.2s linear forwards;
    z-index: 9999;
    border-radius: 50%;
  }

  @keyframes fall {
    to { transform: translateY(120vh) rotate(900deg); }
  }

  .button-container {
    display: flex;
    justify-content: center;
    gap: 10px;
    flex-wrap: wrap;
    margin: 15px 0;
  }
</style>
</head>
<body>
<div class="main-card">

<header>
  <h2>ğŸš€ Ø³Ø§Ù…Ø§Ù†Ù‡ Ù‡ÙˆØ´Ù…Ù†Ø¯ Ø¢Ù…ÙˆØ²Ø´</h2>
  <div id="date"></div>
  <div class="badge">ğŸ“ ÙØ§Ø±Ø³ÛŒ Ø´Ø´Ù… | Ø²ÛŒÙ†Ø¨ Ø·Ø§Ø¦ÛŒ</div>
  <button class="music-icon-btn" onclick="toggleBackgroundMusic()" id="musicToggleBtn">ğŸ”Š</button>
</header>

<div id="introScreen">
  <div class="intro-panel">
    <div class="intro-title">ğŸ“š Ø³Ø§Ù…Ø§Ù†Ù‡ Ù‡ÙˆØ´Ù…Ù†Ø¯ Ø¢Ù…ÙˆØ²Ø´ Ùˆ Ø§Ø±Ø²ÛŒØ§Ø¨ÛŒ ÙØ§Ø±Ø³ÛŒ Ø´Ø´Ù… Ø§Ø¨ØªØ¯Ø§ÛŒÛŒ</div>
    <div class="intro-text">
      <p>Ø¨Ø§ Ø³Ù„Ø§Ù…</p>
      <p>Ø§ÛŒÙ† Ø³Ø§Ù…Ø§Ù†Ù‡ Ø¨Ø§ Ø¨Ù‡Ø±Ù‡â€ŒÚ¯ÛŒØ±ÛŒ Ø§Ø² Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒØŒ Ø¨Ù‡ Ù…Ù†Ø¸ÙˆØ± Ø§Ø±ØªÙ‚Ø§ÛŒ Ú©ÛŒÙÛŒØª Ø¢Ù…ÙˆØ²Ø´ Ùˆ Ø¨Ù‡Ø¨ÙˆØ¯ Ø§Ø±Ø²ÛŒØ§Ø¨ÛŒ Ø¯Ø±Ø³ ÙØ§Ø±Ø³ÛŒ Ù¾Ø§ÛŒÙ‡ Ø´Ø´Ù… Ø·Ø±Ø§Ø­ÛŒ Ø´Ø¯Ù‡ Ø§Ø³Øª.</p>
      <p style="margin-top:20px; font-weight:bold;">Ø·Ø±Ø§Ø­ÛŒ Ùˆ ØªÙˆØ³Ø¹Ù‡: Ø²ÛŒÙ†Ø¨ Ø·Ø§Ø¦ÛŒ</p>
    </div>
    <button class="intro-btn" onclick="startIntro()">ğŸš€ Ø´Ø±ÙˆØ¹ Ø¨Ø§Ø²ÛŒ</button>
  </div>
</div>

<div id="ruleBanner" class="rule-banner hidden">
  <div class="rule-item"><span>âœ…</span> ØµØ­ÛŒØ­: Û±Û°+</div>
  <div class="rule-item"><span>âŒ</span> ØºÙ„Ø·: Ûµ-</div>
  <div class="rule-item"><span>â°</span> Ø²Ù…Ø§Ù†: Ûµ-</div>
</div>

<div id="modeSelection" class="hidden">
  <div style="background:rgba(0,20,40,0.9); border-radius:60px; padding:30px; border:4px solid #ffaa22;">
    <div style="font-size:2rem; color:#ffdb8e; margin-bottom:25px;">ğŸ® Ø§Ù†ØªØ®Ø§Ø¨ Ø­Ø§Ù„Øª Ø¨Ø§Ø²ÛŒ</div>
    <div style="display:flex; gap:15px; justify-content:center; flex-wrap:wrap;">
      <button onclick="showNameDialog('single')" style="background:#ffe187; border:4px solid #fffeb0; border-radius:60px; padding:15px 30px; font-size:1.5rem; font-weight:900; border-bottom:8px solid #9b5e00; cursor:pointer;">ğŸ§‘â€ğŸš€ ÛŒÚ© Ù†ÙØ±Ù‡</button>
      <button onclick="showNameDialog('double')" style="background:#ffe187; border:4px solid #fffeb0; border-radius:60px; padding:15px 30px; font-size:1.5rem; font-weight:900; border-bottom:8px solid #9b5e00; cursor:pointer;">ğŸ‘¥ Ø¯Ùˆ Ù†ÙØ±Ù‡</button>
    </div>
  </div>
</div>

<div id="launchScreen" class="launch-pad hidden">
  <div id="countdown">Û³</div>
  <div class="balloon-container">
    <div class="balloon-house" id="balloon">
      <div class="balloon">
        <div class="balloon-main"><div class="balloon-shine"></div></div>
        <div class="balloon-ropes"></div>
        <div class="balloon-basket"></div>
      </div>
    </div>
    <div class="stars" id="stars"></div>
  </div>
  <button class="intro-btn" onclick="popBalloon()" style="margin-top:20px;">ğŸˆ Ú©Ù„ÛŒÚ© Ú©Ù†</button>
</div>

<div id="gameArea" class="hidden">
  <div class="game-panel">
    <div class="score-row">
      <span id="player1Tag" class="player-badge">Ø¨Ø§Ø²ÛŒÚ©Ù† 1</span>
      <span>â­ <span id="score1">0</span> : <span id="score2">0</span> â­</span>
      <span id="player2Tag" class="player-badge">Ø¨Ø§Ø²ÛŒÚ©Ù† 2</span>
    </div>
    <div class="info-bar">
      <span id="turnDisplay">Ù†ÙˆØ¨Øª:</span>
      <span id="timer">Û²Û°</span>
    </div>
    <div class="question-counter" id="questionCounter">Ø³ÙˆØ§Ù„ Û± Ø§Ø² Û²Û°</div>
    <div id="questionBox" class="question-card">...</div>
    <div id="answers" class="answer-grid"></div>
    <div id="feedback">âœ¨ Ø¢Ù…Ø§Ø¯Ù‡â€ŒØ§ÛŒØŸ âœ¨</div>
  </div>
</div>

<div id="resultScreen" class="hidden">
  <div class="result-panel">
    <div id="winnerText" style="font-size:2.5rem;"></div>
    <div id="finalScoreText" style="font-size:2rem; margin:15px;"></div>
    <div class="score-summary" id="totalScoreSummary"></div>
    <div class="report-card" id="reportCard"></div>
    <div class="button-container">
      <button class="action-btn" onclick="downloadPDF()">ğŸ“¥ Ø¯Ø±ÛŒØ§ÙØª Ú©Ø§Ø±Ù†Ø§Ù…Ù‡ PDF</button>
      <button class="restart-btn" onclick="restartGame()">ğŸ”„ Ø¨Ø§Ø²ÛŒ Ø¬Ø¯ÛŒØ¯</button>
    </div>
  </div>
</div>

<div id="nameDialog" class="custom-dialog hidden">
  <div class="dialog-box">
    <h3 id="dialogTitle">ğŸ§‘â€ğŸš€ Ù†Ø§Ù… Ø¨Ø§Ø²ÛŒÚ©Ù†</h3>
    <input type="text" id="playerNameInput" class="dialog-input" placeholder="Ù†Ø§Ù… Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯...">
    <button class="dialog-btn" onclick="submitName()">âœ… ØªØ£ÛŒÛŒØ¯</button>
  </div>
</div>

<script>
(function() {
  document.getElementById("date").innerText = "ğŸ“… " + new Date().toLocaleDateString('fa-IR');

  // ==================== Ø¨Ø§Ù†Ú© Ø³ÙˆØ§Ù„Ø§Øª Ø¨Ø§ Ø¬ÙˆØ§Ø¨â€ŒÙ‡Ø§ÛŒ Ø¯Ø±Ø³Øª ====================
  const baseQuestions = [
    { q: "Ù…Ø¹Ù†ÛŒ Ú©Ù„Ù…Ù‡ Â«ÙØ±Ù‡ÛŒØ®ØªÙ‡Â» Ú†ÛŒØ³ØªØŸ", a: ["Ø¯Ø§Ù†Ø´Ù…Ù†Ø¯ Ùˆ Ø¨Ø§Ø³ÙˆØ§Ø¯", "Ù†Ø§Ø¯Ø§Ù† Ùˆ Ø¬Ø§Ù‡Ù„", "ØªØ§Ø²Ù‡â€ŒÚ©Ø§Ø± Ùˆ Ù…Ø¨ØªØ¯ÛŒ", "Ú©Ù…â€ŒØªØ¬Ø±Ø¨Ù‡ Ùˆ Ø®Ø§Ù…"], c: 0, exp: "ÙØ±Ù‡ÛŒØ®ØªÙ‡ ÛŒØ¹Ù†ÛŒ Ú©Ø³ÛŒ Ú©Ù‡ Ø¹Ù„Ù… Ùˆ Ø¯Ø§Ù†Ø´ Ø¢Ù…ÙˆØ®ØªÙ‡ Ø§Ø³Øª." },
    { q: "Ù…ØªØ±Ø§Ø¯Ù Â«Ø¢Ú¯Ø§Ù‡Â» Ú©Ø¯Ø§Ù… Ø§Ø³ØªØŸ", a: ["Ù…Ø·Ù„Ø¹ Ùˆ Ø¨Ø§Ø®Ø¨Ø±", "Ø¨ÛŒâ€ŒØ®Ø¨Ø± Ùˆ ØºØ§ÙÙ„", "Ù†Ø§Ø¢Ø´Ù†Ø§ Ùˆ Ø¨ÛŒÚ¯Ø§Ù†Ù‡", "Ø®ÙˆØ§Ø¨â€ŒØ¢Ù„ÙˆØ¯ Ùˆ Ú©Ø³Ù„"], c: 0, exp: "Ø¢Ú¯Ø§Ù‡ ÛŒØ¹Ù†ÛŒ Ú©Ø³ÛŒ Ú©Ù‡ Ø§Ø² Ú†ÛŒØ²ÛŒ Ø¨Ø§Ø®Ø¨Ø± Ø§Ø³Øª." },
    { q: "Ù…ØªØ¶Ø§Ø¯ Â«Ø¢Ø´Ú©Ø§Ø±Â» Ú©Ø¯Ø§Ù… Ø§Ø³ØªØŸ", a: ["Ù¾Ù†Ù‡Ø§Ù† Ùˆ Ù…Ø®ÙÛŒ", "Ø±ÙˆØ´Ù† Ùˆ ØªØ§Ø¨Ø§Ù†", "Ø¯Ø±Ø®Ø´Ø§Ù† Ùˆ ÙØ±ÙˆØ²Ø§Ù†", "Ø¹ÛŒØ§Ù† Ùˆ Ù‡ÙˆÛŒØ¯Ø§"], c: 0, exp: "Ø¢Ø´Ú©Ø§Ø± ÛŒØ¹Ù†ÛŒ Ù¾ÛŒØ¯Ø§ Ùˆ Ù†Ù…Ø§ÛŒØ§Ù†ØŒ Ù¾Ø³ Ù…ØªØ¶Ø§Ø¯ Ø¢Ù† Ù¾Ù†Ù‡Ø§Ù† Ø§Ø³Øª." },
    { q: "Ù…Ø¹Ù†ÛŒ Â«Ø¨Ø§Ù…Ø¯Ø§Ø¯Â» Ú†ÛŒØ³ØªØŸ", a: ["ØµØ¨Ø­Ú¯Ø§Ù‡ Ùˆ Ø³Ù¾ÛŒØ¯Ù‡â€ŒØ¯Ù…", "Ù†ÛŒÙ…Ù‡â€ŒØ´Ø¨ Ùˆ Ø´Ø¨Ø§Ù†Ú¯Ø§Ù‡", "ØºØ±ÙˆØ¨ Ø¢ÙØªØ§Ø¨", "Ø¸Ù‡Ø± Ú¯Ø±Ù…"], c: 0, exp: "Ø¨Ø§Ù…Ø¯Ø§Ø¯ Ø¨Ù‡ Ø§ÙˆÙ„ ØµØ¨Ø­ Ú¯ÙØªÙ‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯." },
    { q: "Ú©Ù„Ù…Ù‡ Â«Ø´Ú©ÛŒØ¨Ø§Â» Ø¨Ù‡ Ú†Ù‡ Ù…Ø¹Ù†Ø§Ø³ØªØŸ", a: ["ØµØ¨ÙˆØ± Ùˆ Ø¨Ø±Ø¯Ø¨Ø§Ø±", "Ø¹Ø¬ÙˆÙ„ Ùˆ Ø¨ÛŒâ€ŒØªØ§Ø¨", "Ø®Ø´Ù…Ú¯ÛŒÙ† Ùˆ Ø¹ØµØ¨ÛŒ", "Ø¨ÛŒâ€ŒØ­ÙˆØµÙ„Ù‡ Ùˆ Ù…Ù„ÙˆÙ„"], c: 0, exp: "Ø´Ú©ÛŒØ¨Ø§ ÛŒØ¹Ù†ÛŒ Ú©Ø³ÛŒ Ú©Ù‡ ØªØ­Ù…Ù„ Ø¯Ø§Ø±Ø¯." },
    { q: "Ù…Ø¹Ù†ÛŒ Â«Ø®Ø±Ø§Ù…Ø§Ù†Â» Ú©Ø¯Ø§Ù… Ø§Ø³ØªØŸ", a: ["Ø¨Ø§ Ù†Ø§Ø² Ùˆ Ú©Ø±Ø´Ù…Ù‡ Ø±Ø§Ù‡ Ø±ÙØªÙ†", "Ø³Ø±ÛŒØ¹ Ø¯ÙˆÛŒØ¯Ù†", "Ù…Ø®ÙÛŒØ§Ù†Ù‡ Ø±ÙØªÙ†", "Ù¾Ø±ÛŒØ¯Ù† Ùˆ Ø¬Ù‡ÛŒØ¯Ù†"], c: 0, exp: "Ø®Ø±Ø§Ù…Ø§Ù† Ø¨Ù‡ Ø±Ø§Ù‡ Ø±ÙØªÙ† Ø¨Ø§ÙˆÙ‚Ø§Ø± Ú¯ÙØªÙ‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯." },
    { q: "Â«Ø®Ø±Ø¯Â» Ø¨Ù‡ Ú†Ù‡ Ù…Ø¹Ù†Ø§Ø³ØªØŸ", a: ["Ø¹Ù‚Ù„ Ùˆ Ø¯Ø§Ù†Ø§ÛŒÛŒ", "ØªÙ† Ùˆ Ú©Ø§Ù„Ø¨Ø¯", "Ø²Ù…ÛŒÙ† Ùˆ Ø®Ø§Ú©", "Ø¢Ø¨ Ùˆ Ø±Ø·ÙˆØ¨Øª"], c: 0, exp: "Ø®Ø±Ø¯ Ø¨Ù‡ Ù…Ø¹Ù†Ø§ÛŒ Ø¹Ù‚Ù„ Ùˆ Ø¯Ø§Ù†Ø´ Ø§Ø³Øª." },
    { q: "Ù…Ø¹Ù†ÛŒ Â«ÙØ±Ø§Ø²Â» Ú©Ø¯Ø§Ù… Ø§Ø³ØªØŸ", a: ["Ø¨Ø§Ù„Ø§ Ùˆ Ø¨Ù„Ù†Ø¯ÛŒ", "Ù¾Ø§ÛŒÛŒÙ† Ùˆ Ù†Ø´ÛŒØ¨", "Ú©Ù†Ø§Ø± Ùˆ Ù¾Ù‡Ù„Ùˆ", "Ø¯Ø§Ø®Ù„ Ùˆ Ù…ÛŒØ§Ù†"], c: 0, exp: "ÙØ±Ø§Ø² Ø¨Ù‡ Ù…Ø¹Ù†Ø§ÛŒ Ø¨Ø§Ù„Ø§ Ùˆ Ø¨Ù„Ù†Ø¯ÛŒ Ø§Ø³Øª." },
    { q: "Â«Ù†Ø´ÛŒØ¨Â» ÛŒØ¹Ù†ÛŒ Ú†Ù‡ØŸ", a: ["Ø³Ø±Ø§Ø²ÛŒØ±ÛŒ Ùˆ Ù¾Ø§ÛŒÛŒÙ†", "Ù‚Ù„Ù‡ Ùˆ Ø§ÙˆØ¬", "Ø¯Ø´Øª Ù‡Ù…ÙˆØ§Ø±", "Ú©ÙˆÙ‡ Ø¨Ù„Ù†Ø¯"], c: 0, exp: "Ù†Ø´ÛŒØ¨ Ø¨Ù‡ Ø²Ù…ÛŒÙ† Ø´ÛŒØ¨â€ŒØ¯Ø§Ø± Ú¯ÙØªÙ‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯." },
    { q: "Ù…Ø¹Ù†ÛŒ Â«Ú˜ÛŒØ§Ù†Â» Ú†ÛŒØ³ØªØŸ", a: ["Ø´ÛŒØ± Ø¯Ø±Ù†Ø¯Ù‡", "Ø¢Ù‡ÙˆÛŒ Ø²ÛŒØ¨Ø§", "Ú¯ÙˆØ³ÙÙ†Ø¯ Ø§Ù‡Ù„ÛŒ", "Ú¯Ø±Ø¨Ù‡ ÙˆØ­Ø´ÛŒ"], c: 0, exp: "Ú˜ÛŒØ§Ù† ØµÙØª Ø´ÛŒØ± Ø¯Ø±Ù†Ø¯Ù‡ Ø§Ø³Øª." },
    { q: "Ù…ØªØ±Ø§Ø¯Ù Â«Ø³Ù¾ÛŒØ¯Â» Ú†ÛŒØ³ØªØŸ", a: ["Ø³ÙÛŒØ¯ Ùˆ Ø±ÙˆØ´Ù†", "Ø³ÛŒØ§Ù‡ Ùˆ ØªØ§Ø±ÛŒÚ©", "Ø®Ø§Ú©Ø³ØªØ±ÛŒ", "Ú©Ø¨ÙˆØ¯ Ùˆ Ø¢Ø¨ÛŒ"], c: 0, exp: "Ø³Ù¾ÛŒØ¯ Ù‡Ù…Ø§Ù† Ø³ÙÛŒØ¯ Ø§Ø³Øª." },
    { q: "Ù…ØªØ¶Ø§Ø¯ Â«Ú¯Ø±Ù…Â» Ú©Ø¯Ø§Ù… Ø§Ø³ØªØŸ", a: ["Ø³Ø±Ø¯ Ùˆ Ø®Ù†Ú©", "Ø¯Ø§Øº Ùˆ Ø³ÙˆØ²Ø§Ù†", "Ù…Ø¹ØªØ¯Ù„ Ùˆ Ù…Ù„Ø§ÛŒÙ…", "Ú¯Ø±Ù…Ø§ÛŒ Ø´Ø¯ÛŒØ¯"], c: 0, exp: "Ú¯Ø±Ù… Ø¶Ø¯ Ø³Ø±Ø¯ Ø§Ø³Øª." },
    { q: "Ù…Ø¹Ù†ÛŒ Â«Ø±Ù‡Ø³Ù¾Ø§Ø±Â» Ú†ÛŒØ³ØªØŸ", a: ["Ù…Ø³Ø§ÙØ± Ùˆ Ø±Ø§Ù‡ÛŒ", "Ø®Ø§Ù†Ù‡â€ŒÙ†Ø´ÛŒÙ†", "Ù…Ù‚ÛŒÙ… Ø¯Ø§Ø¦Ù…", "Ø³Ø§Ú©Ù†"], c: 0, exp: "Ø±Ù‡Ø³Ù¾Ø§Ø± Ø¨Ù‡ Ú©Ø³ÛŒ Ú¯ÙØªÙ‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯ Ú©Ù‡ Ø¨Ù‡ Ø³ÙØ± Ù…ÛŒâ€ŒØ±ÙˆØ¯." },
    { q: "Â«Ù¾ÙˆÛŒØ§Â» ÛŒØ¹Ù†ÛŒ Ú†Ù‡ØŸ", a: ["ÙØ¹Ø§Ù„ Ùˆ Ø¬Ø³ØªØ¬ÙˆÚ¯Ø±", "Ø³Ø§Ú©Ù† Ùˆ Ø¨ÛŒâ€ŒØ­Ø±Ú©Øª", "Ø§ÛŒØ³ØªØ§ Ùˆ Ø±Ø§Ú©Ø¯", "Ø®Ø§Ù…ÙˆØ´ Ùˆ Ø³Ø§Ú©Øª"], c: 0, exp: "Ù¾ÙˆÛŒØ§ Ø¨Ù‡ Ù…Ø¹Ù†Ø§ÛŒ ÙØ¹Ø§Ù„ Ùˆ Ú©ÙˆØ´Ø§ Ø§Ø³Øª." },
    { q: "Ù…Ø¹Ù†ÛŒ Â«Ø®Ø²ÛŒØ¯Ù‡Â» Ú†ÛŒØ³ØªØŸ", a: ["Ø¢Ù‡Ø³ØªÙ‡ Ùˆ Ù¾Ù†Ù‡Ø§Ù†ÛŒ Ø±ÙØªÙ†", "ØªÙ†Ø¯ Ø¯ÙˆÛŒØ¯Ù†", "Ù¾Ø±ÛŒØ¯Ù†", "ØºÙ„ØªÛŒØ¯Ù†"], c: 0, exp: "Ø®Ø²ÛŒØ¯Ù‡ ÛŒØ¹Ù†ÛŒ Ø¢Ù‡Ø³ØªÙ‡ Ø­Ø±Ú©Øª Ú©Ø±Ø¯Ù†." },
    { q: "Ø¬Ù…Ø¹ Â«Ú©ØªØ§Ø¨Â» Ú©Ø¯Ø§Ù… Ø§Ø³ØªØŸ", a: ["Ú©ÙØªÙØ¨", "Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡", "Ú©ØªØ§Ø¨Ø¯Ø§Ø±", "Ú©ØªØ§Ø¨ÙØ±ÙˆØ´"], c: 0, exp: "Ø¬Ù…Ø¹ Ù…Ú©Ø³Ø± Ú©ØªØ§Ø¨ Â«Ú©ÙØªÙØ¨Â» Ø§Ø³Øª." },
    { q: "Ø¬Ù…Ø¹ Â«Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Â» Ú©Ø¯Ø§Ù… Ø§Ø³ØªØŸ", a: ["Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù†", "Ø¯Ø§Ù†Ø´Ú¯Ø§Ù‡", "Ø¯Ø§Ù†Ø´Ú©Ø¯Ù‡", "Ø¯Ø§Ù†Ø´Ø³Ø±Ø§"], c: 0, exp: "Ø¬Ù…Ø¹ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ø¨Ø§ Â«Ø§Ù†Â» Ø³Ø§Ø®ØªÙ‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯." },
    { q: "Ø¬Ù…Ø¹ Ù…Ú©Ø³Ø± Â«Ù…Ø¹Ù„Ù…Â» Ú†ÛŒØ³ØªØŸ", a: ["Ù…Ø¹Ù„Ù…Ø§Ù†", "Ø¯Ø¨ÛŒØ±", "Ø§Ø³ØªØ§Ø¯", "Ø¢Ù…ÙˆØ²Ú¯Ø§Ø±"], c: 0, exp: "Ø¬Ù…Ø¹ Ù…Ú©Ø³Ø± Ù…Ø¹Ù„Ù… Â«Ù…Ø¹Ù„Ù…Ø§Ù†Â» Ø§Ø³Øª." },
    { q: "Ø¬Ù…Ø¹ Ù…Ú©Ø³Ø± Â«Ø¨ÛŒØªÂ» Ú©Ø¯Ø§Ù… Ø§Ø³ØªØŸ", a: ["Ø§Ø¨ÛŒØ§Øª", "Ø´Ø¹Ø±", "ØºØ²Ù„", "Ù‚ØµÛŒØ¯Ù‡"], c: 0, exp: "Ø¬Ù…Ø¹ Ù…Ú©Ø³Ø± Ø¨ÛŒØª Â«Ø§Ø¨ÛŒØ§ØªÂ» Ø§Ø³Øª." },
    { q: "Ø¬Ù…Ø¹ Â«ÙˆØ±Ø²Ø´Ú©Ø§Ø±Â» Ú©Ø¯Ø§Ù… Ø§Ø³ØªØŸ", a: ["ÙˆØ±Ø²Ø´Ú©Ø§Ø±Ø§Ù†", "ÙˆØ±Ø²Ø´Ú¯Ø§Ù‡", "ÙˆØ±Ø²Ø´ÛŒ", "ÙˆØ±Ø²Ø´Ú¯Ø§Ø±"], c: 0, exp: "Ø¬Ù…Ø¹ ÙˆØ±Ø²Ø´Ú©Ø§Ø± Ø¨Ø§ Â«Ø§Ù†Â» Ø³Ø§Ø®ØªÙ‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯." }
  ];

  // Ø³Ø§Ø®Øª Ø¨Ø§Ù†Ú© Ø³ÙˆØ§Ù„
  let questionBank = [];
  for (let i = 0; i < baseQuestions.length; i++) {
    const base = baseQuestions[i];
    questionBank.push({
      id: i + 1,
      q: base.q,
      a: [...base.a],
      c: base.c,
      exp: base.exp
    });
  }

  let gameMode = null;
  let p1 = "", p2 = "";
  let score1 = 0, score2 = 0;
  let currentQuestions = [];
  let currentIndex = 0;
  let timerInterval = null;
  let timeLeft = 20;
  let turn = 1;
  let answerLock = false;
  let nameStep = 1;
  let countdownInterval = null;
  let playerResults = [];
  //Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯ Ø¨Ø±Ø§ÛŒ ØµØ¯Ø§ÛŒ Ù‡Ø´Ø¯Ø§Ø± ØªØ§ÛŒÙ…Ø±
  let warningSoundInterval = null;
  let audioContext = null;

  const MAX_POSSIBLE_SCORE = 200;

  const introScreen = document.getElementById('introScreen');
  const ruleBanner = document.getElementById('ruleBanner');
  const modeDiv = document.getElementById('modeSelection');
  const launchScreen = document.getElementById('launchScreen');
  const gameArea = document.getElementById('gameArea');
  const resultScreen = document.getElementById('resultScreen');
  const nameDialog = document.getElementById('nameDialog');
  const dialogTitle = document.getElementById('dialogTitle');
  const playerNameInput = document.getElementById('playerNameInput');
  const balloon = document.getElementById('balloon');
  const reportCard = document.getElementById('reportCard');
  
  const player1Tag = document.getElementById('player1Tag');
  const player2Tag = document.getElementById('player2Tag');
  const score1Span = document.getElementById('score1');
  const score2Span = document.getElementById('score2');
  const turnDisplay = document.getElementById('turnDisplay');
  const timerSpan = document.getElementById('timer');
  const questionBox = document.getElementById('questionBox');
  const answersDiv = document.getElementById('answers');
  const feedbackDiv = document.getElementById('feedback');
  const questionCounter = document.getElementById('questionCounter');
  const winnerText = document.getElementById('winnerText');
  const finalScoreText = document.getElementById('finalScoreText');
  const totalScoreSummary = document.getElementById('totalScoreSummary');
  const medalIcon = document.getElementById('medalIcon');
  
  // ==================== ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù…ÙˆØ²ÛŒÚ© Ø²Ù…ÛŒÙ†Ù‡ ====================
let backgroundMusic = null;
let isMusicPlaying = false;
const musicToggleBtn = document.getElementById('musicToggleBtn');

// Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ù…ÙˆØ²ÛŒÚ© Ø²Ù…ÛŒÙ†Ù‡
function initBackgroundMusic() { 
  if (!backgroundMusic) {
    backgroundMusic = new Audio('https://dl.sedatoseda.com/sound/prince-of-persia%20(4).mp3?src=sedatoseda');
    backgroundMusic.loop = true;
    backgroundMusic.volume = 0.4;
    backgroundMusic.preload = 'auto'; // Ø§ÛŒÙ† Ø®Ø· Ø±Ùˆ Ø§Ø¶Ø§ÙÙ‡ Ú©Ù† - ÙØ§ÛŒÙ„ Ø±Ùˆ Ø§Ø² Ù‚Ø¨Ù„ Ø¢Ù…Ø§Ø¯Ù‡ Ù†Ú¯Ù‡ Ù…ÛŒâ€ŒØ¯Ø§Ø±Ù‡
    
    backgroundMusic.preservesPitch = true;
    backgroundMusic.mozPreservesPitch = true;
    backgroundMusic.webkitPreservesPitch = true;
  }
}

// ØªØ§Ø¨Ø¹ Ù¾Ø®Ø´/Ù‚Ø·Ø¹ Ù…ÙˆØ²ÛŒÚ©
window.toggleBackgroundMusic = function() {
  initBackgroundMusic();
  
  if (isMusicPlaying) {
    backgroundMusic.pause();
    musicToggleBtn.innerHTML = 'ğŸ”Š';  // Ø¢ÛŒÚ©ÙˆÙ† Ù‚Ø·Ø¹
    isMusicPlaying = false;
  } else {
    backgroundMusic.play().then(() => {
      musicToggleBtn.innerHTML = 'ğŸ”‡';  // Ø¢ÛŒÚ©ÙˆÙ† Ù¾Ø®Ø´
      isMusicPlaying = true;
    }).catch(error => {
      console.log('Ù¾Ø®Ø´ Ù…ÙˆØ²ÛŒÚ© Ø§Ù…Ú©Ø§Ù†â€ŒÙ¾Ø°ÛŒØ± Ù†ÛŒØ³Øª:', error);
      alert('Ø¨Ø±Ø§ÛŒ Ù¾Ø®Ø´ Ù…ÙˆØ²ÛŒÚ©ØŒ Ù„Ø·ÙØ§Ù‹ Ø§Ø¨ØªØ¯Ø§ Ø±ÙˆÛŒ ØµÙØ­Ù‡ Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯.');
    });
  }
};

// Ù¾Ø®Ø´ Ø®ÙˆØ¯Ú©Ø§Ø± Ø¨Ø§ Ø§ÙˆÙ„ÛŒÙ† Ú©Ù„ÛŒÚ© Ú©Ø§Ø±Ø¨Ø±
document.addEventListener('click', function initMusicOnFirstClick() {
  if (!backgroundMusic && !isMusicPlaying) {
    initBackgroundMusic();
    backgroundMusic.play().then(() => {
      musicToggleBtn.innerHTML = 'ğŸ”‡';
      isMusicPlaying = true;
    }).catch(() => {});
  }
  document.removeEventListener('click', initMusicOnFirstClick);
}, { once: true });
  
  // ================ ØªØ§Ø¨Ø¹ Ù¾Ø®Ø´ ØµØ¯Ø§ÛŒ Ù‡Ø´Ø¯Ø§Ø± ================
  function playWarningSound() {
    try {
      if (!audioContext) {
        audioContext = new (window.AudioContext || window.webkitAudioContext)();
      }
      
      if (audioContext.state === 'suspended') {
        audioContext.resume();
      }
      
      const oscillator = audioContext.createOscillator();
      const gainNode = audioContext.createGain();
      
      oscillator.type = 'sine';
      oscillator.frequency.setValueAtTime(880, audioContext.currentTime); // Ù†Øª Ù„Ø§ (A5)
      
      gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
      gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 0.2);
      
      oscillator.connect(gainNode);
      gainNode.connect(audioContext.destination);
      
      oscillator.start();
      oscillator.stop(audioContext.currentTime + 0.2);
    } catch (e) {
      console.log('Audio not supported', e);
    }
  }

  // ================ ØªØ§Ø¨Ø¹ Ù‚Ø·Ø¹ ØµØ¯Ø§ÛŒ Ù‡Ø´Ø¯Ø§Ø± ================
  function stopWarningSound() {
    if (warningSoundInterval) {
      clearInterval(warningSoundInterval);
      warningSoundInterval = null; 
    }
  }
  
  // ================ ØªØ§Ø¨Ø¹ Ù¾Ø®Ø´ ØµØ¯Ø§ÛŒ ØªØ±Ú©ÛŒØ¯Ù† Ø¨Ø§Ø¯Ú©Ù†Ú© ================
  function playPopSound() {
  try {
    // --- Ú©Ø¯ Ø§ØµÙ„ÛŒ Web Audio API ---
    if (!audioContext) {
      audioContext = new (window.AudioContext || window.webkitAudioContext)();
    }

    if (audioContext.state === 'suspended') { 
      audioContext.resume(); 
    }

    const oscillator = audioContext.createOscillator();
    const gainNode = audioContext.createGain();

    oscillator.type = 'sine';
    oscillator.frequency.setValueAtTime(180, audioContext.currentTime);
    oscillator.frequency.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 0.15);

    gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
    gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 0.15);

    oscillator.connect(gainNode);
    gainNode.connect(audioContext.destination);

    oscillator.start();
    oscillator.stop(audioContext.currentTime + 0.15);

    // --- Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† ØµØ¯Ø§ÛŒ MP3 ---
    const audio = new Audio('https://sedatoseda.com/wp-content/uploads/321.mp3');
    audio.play().catch(error => {
      console.warn('Audio play was blocked. User interaction may be required.', error);
    });

  } catch (e) {
    console.log('Audio not supported', e);
  }
}

  window.startIntro = function() {
    introScreen.classList.add('hidden');
    ruleBanner.classList.remove('hidden');
    modeDiv.classList.remove('hidden');
    initMusicOnFirstClick();
  };

  window.showNameDialog = function(mode) {
    gameMode = mode;
    nameStep = 1;
    dialogTitle.innerText = mode === 'single' ? 'ğŸ§‘â€ğŸš€ Ù†Ø§Ù… Ø¨Ø§Ø²ÛŒÚ©Ù† Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯' : 'ğŸ‘¤ Ù†Ø§Ù… Ø¨Ø§Ø²ÛŒÚ©Ù† Ø§ÙˆÙ„ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯';
    playerNameInput.value = '';
    nameDialog.classList.remove('hidden');
    playerNameInput.focus();
  };

  window.submitName = function() {
    const name = playerNameInput.value.trim();
    if (name === '') { alert('Ù„Ø·ÙØ§Ù‹ Ù†Ø§Ù… Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯'); return; }
    
    if (gameMode === 'single') {
      p1 = name; p2 = "";
      nameDialog.classList.add('hidden');
      modeDiv.classList.add('hidden');
      launchScreen.classList.remove('hidden');
      createStars();
    } else {
      if (nameStep === 1) {
        p1 = name;
        nameStep = 2;
        dialogTitle.innerText = 'ğŸ‘¤ Ù†Ø§Ù… Ø¨Ø§Ø²ÛŒÚ©Ù† Ø¯ÙˆÙ… Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯';
        playerNameInput.value = '';
        playerNameInput.focus();
      } else {
        p2 = name;
        nameDialog.classList.add('hidden');
        modeDiv.classList.add('hidden');
        launchScreen.classList.remove('hidden');
        createStars();
      }
    }
  };

  function createStars() {
    const starsContainer = document.getElementById('stars');
    starsContainer.innerHTML = '';
    for (let i = 0; i < 60; i++) {
      const star = document.createElement('div');
      star.className = 'star';
      star.style.left = Math.random() * 100 + '%';
      star.style.top = Math.random() * 100 + '%';
      star.style.width = (Math.random() * 5 + 1) + 'px';
      star.style.height = star.style.width;
      star.style.animationDelay = Math.random() * 2 + 's';
      starsContainer.appendChild(star);
    }
  }

  window.popBalloon = function() {
    playPopSound(); // Ù¾Ø®Ø´ ØµØ¯Ø§ÛŒ ØªØ±Ú©ÛŒØ¯Ù† Ø¨Ø§Ø¯Ú©Ù†Ú©
    if (balloon) {
      balloon.classList.add('balloon-poof');
      setTimeout(() => startCountdown(), 500);
    }
  };

  window.startCountdown = function() {
    let count = 3;
    document.getElementById("countdown").innerText = 'Û³';
    countdownInterval = setInterval(() => {
      count--;
      if (count > 0) {
        const persianNumbers = ['Û°', 'Û±', 'Û²', 'Û³', 'Û´', 'Ûµ', 'Û¶', 'Û·', 'Û¸', 'Û¹'];
        document.getElementById("countdown").innerText = persianNumbers[count];
      } else {
        document.getElementById("countdown").innerText = 'ğŸˆ';
        clearInterval(countdownInterval);
        setTimeout(() => {
          launchScreen.classList.add('hidden');
          startNewGame();
        }, 1000);
      }
    }, 1000);
  };

  function shuffleArray(array) {
    for (let i = array.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [array[i], array[j]] = [array[j], array[i]];
    }
    return array;
  }

  function startNewGame() {
    player1Tag.innerText = p1;
    player2Tag.innerText = (gameMode === 'single') ? 'â€”' : p2;

    score1 = 0; score2 = 0; currentIndex = 0; turn = 1;
    answerLock = false; playerResults = [];
    updateScores();

    let shuffled = [...questionBank];
    for (let i = shuffled.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
    }
    
    let selected = [], seenIds = new Set();
    for (let q of shuffled) {
      if (!seenIds.has(q.id)) {
        seenIds.add(q.id);
        selected.push(q);
        if (selected.length >= 20) break;
      }
    }
    currentQuestions = selected;

    gameArea.classList.remove('hidden');
    resultScreen.classList.add('hidden');
    nextQuestion();
  }

  function nextQuestion() {
    // Ù‚Ø·Ø¹ ØµØ¯Ø§ÛŒ Ù‡Ø´Ø¯Ø§Ø± Ù‚Ø¨Ù„ÛŒ
    stopWarningSound();
    
    if (currentIndex >= currentQuestions.length) { finishGame(); return; }
    clearTimer();
    timeLeft = 20;
    timerSpan.innerText = timeLeft;
    answerLock = false;

    questionCounter.innerText = `Ø³ÙˆØ§Ù„ ${currentIndex+1} Ø§Ø² ${currentQuestions.length}`;

    const originalQ = currentQuestions[currentIndex];
    
    // ÙÙ‚Ø· Ø¬Ø§ÛŒ Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ Ø±Ùˆ Ø¹ÙˆØ¶ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…ØŒ Ø¬ÙˆØ§Ø¨ Ø¯Ø±Ø³Øª Ø±Ùˆ Ø¹ÙˆØ¶ Ù†Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…
    let options = [...originalQ.a];
    let correctAnswer = options[originalQ.c];
    options = shuffleArray(options);
    let newCorrectIndex = options.indexOf(correctAnswer);
    
    const q = {
      q: originalQ.q,
      a: options,
      c: newCorrectIndex,
      exp: originalQ.exp
    };
    
    questionBox.innerText = q.q;

    let btns = '';
    q.a.forEach((opt, idx) => {
      btns += `<div class="answer-option" data-index="${idx}" onclick="handleAnswer(this, ${idx}, ${q.c})">${opt}</div>`;
    });
    answersDiv.innerHTML = btns;

    turnDisplay.innerText = (gameMode === 'single') ? `ğŸ§‘â€ğŸš€ Ù†ÙˆØ¨Øª: ${p1}` : `ğŸ¤ Ù†ÙˆØ¨Øª: ${turn === 1 ? p1 : p2}`;

    timerInterval = setInterval(() => {
      timeLeft--;
      timerSpan.innerText = timeLeft;
      
      // ÙˆÙ‚ØªÛŒ Ø¨Ù‡ Ûµ Ø«Ø§Ù†ÛŒÙ‡ Ø±Ø³ÛŒØ¯ØŒ ØµØ¯Ø§ÛŒ Ù‡Ø´Ø¯Ø§Ø± Ø´Ø±ÙˆØ¹ Ø´ÙˆØ¯
      if (timeLeft === 5) {
        // Ù‡Ø± Û± Ø«Ø§Ù†ÛŒÙ‡ ÛŒÚ© Ø¨Ø§Ø± ØµØ¯Ø§ÛŒ Ù‡Ø´Ø¯Ø§Ø± Ù¾Ø®Ø´ Ø´ÙˆØ¯
        playWarningSound(); // ÛŒÚ© Ø¨Ø§Ø± ÙÙˆØ±ÛŒ Ù¾Ø®Ø´ Ø´ÙˆØ¯
        warningSoundInterval = setInterval(() => {
          playWarningSound();
        }, 1000);
      }
      
      if (timeLeft <= 0) { 
        clearTimer(); 
        stopWarningSound(); // Ù‚Ø·Ø¹ ØµØ¯Ø§ÛŒ Ù‡Ø´Ø¯Ø§Ø±
        timeoutAction(q); 
      }
    }, 1000);
  }

  window.handleAnswer = function(element, selected, correctIndex) {
    if (answerLock) return;
    clearTimer();
    stopWarningSound(); // Ù‚Ø·Ø¹ ØµØ¯Ø§ÛŒ Ù‡Ø´Ø¯Ø§Ø±
    answerLock = true;
    
    const q = currentQuestions[currentIndex];
    const correct = correctIndex;
    const player = (gameMode === 'single' || turn === 1) ? p1 : p2;
    const correctText = q.a[correct];
    const explanation = q.exp;
    
    const allOptions = document.querySelectorAll('.answer-option');
    allOptions.forEach(opt => opt.classList.add('disabled'));
    
    let isCorrect = (selected === correct);
    
    if (isCorrect) {
      element.classList.add('correct-selected');
      if (gameMode === 'single' || turn === 1) score1 += 10; else score2 += 10;
      feedbackDiv.innerHTML = `âœ… Ø¢ÙØ±ÛŒÙ† ${player}! Ù¾Ø§Ø³Ø® Ø¯Ø±Ø³Øª. <br> <span style="font-size:0.9rem;">${explanation}</span>`;
    } else {
      element.classList.add('wrong-selected');
      allOptions.forEach(opt => { if (parseInt(opt.dataset.index) === correct) opt.classList.add('correct-answer-highlight'); });
      if (gameMode === 'single' || turn === 1) score1 = Math.max(0, score1 - 5); else score2 = Math.max(0, score2 - 5);
      feedbackDiv.innerHTML = `âŒ ${player} Ø¬Ø§Ù†ØŒ Ù¾Ø§Ø³Ø® ØµØ­ÛŒØ­: Â«${correctText}Â» <br> <span style="font-size:0.9rem;">${explanation}</span>`;
    }
    
    playerResults.push({ question: q.q, userAnswer: q.a[selected], correctAnswer: correctText, isCorrect, explanation });
    updateScores();
    
    setTimeout(() => {
      currentIndex++;
      if (gameMode === 'double') turn = (turn === 1) ? 2 : 1;
      nextQuestion();
    }, 2000);
  };

  function timeoutAction(q) {
    if (answerLock) return;
    answerLock = true;
    
    const correct = q.c;
    const player = (gameMode === 'single' || turn === 1) ? p1 : p2;
    const correctText = q.a[correct];
    const explanation = q.exp;
    
    const allOptions = document.querySelectorAll('.answer-option');
    allOptions.forEach(opt => opt.classList.add('disabled'));
    allOptions.forEach(opt => { if (parseInt(opt.dataset.index) === correct) opt.classList.add('correct-answer-highlight'); });
    
    if (gameMode === 'single' || turn === 1) score1 = Math.max(0, score1 - 5); else score2 = Math.max(0, score2 - 5);
    feedbackDiv.innerHTML = `â° Ø²Ù…Ø§Ù† Ø±ÙØª! ${player} Ûµ Ø§Ù…ØªÛŒØ§Ø² -. <br> Ù¾Ø§Ø³Ø® ØµØ­ÛŒØ­: Â«${correctText}Â» <br> <span style="font-size:0.9rem;">${explanation}</span>`;
    
    playerResults.push({ question: q.q, userAnswer: "Ø²Ù…Ø§Ù† ØªÙ…Ø§Ù… Ø´Ø¯", correctAnswer: correctText, isCorrect: false, explanation });
    updateScores();
    
    setTimeout(() => {
      currentIndex++;
      if (gameMode === 'double') turn = (turn === 1) ? 2 : 1;
      nextQuestion();
    }, 2000);
  }

  function clearTimer() { if (timerInterval) clearInterval(timerInterval); timerInterval = null; }
  function updateScores() { score1Span.innerText = score1; score2Span.innerText = (gameMode === 'single') ? 'â€”' : score2; }

  function finishGame() {
    stopWarningSound(); // Ù‚Ø·Ø¹ ØµØ¯Ø§ÛŒ Ù‡Ø´Ø¯Ø§Ø± Ø¯Ø± Ù¾Ø§ÛŒØ§Ù† Ø¨Ø§Ø²ÛŒ
    gameArea.classList.add('hidden');
    resultScreen.classList.remove('hidden');

    let winMsg = gameMode === 'single' ? `ğŸ† Ø§Ù…ØªÛŒØ§Ø² Ø´Ù…Ø§: ${score1}` : (score1 > score2 ? `ğŸ† Ù‚Ù‡Ø±Ù…Ø§Ù†: ${p1}` : (score2 > score1 ? `ğŸ† Ù‚Ù‡Ø±Ù…Ø§Ù†: ${p2}` : "ğŸ¤ Ù…Ø³Ø§ÙˆÛŒ"));
    winnerText.innerHTML = `<h2>${winMsg}</h2>`;
    
    if (gameMode === 'single') {
      finalScoreText.innerHTML = `â­ Ø§Ù…ØªÛŒØ§Ø² Ù†Ù‡Ø§ÛŒÛŒ: ${score1} â­`;
      totalScoreSummary.innerHTML = `ğŸ“Š Ø´Ù…Ø§ Ø§Ø² ${MAX_POSSIBLE_SCORE} Ø§Ù…ØªÛŒØ§Ø²ØŒ ${score1} Ø§Ù…ØªÛŒØ§Ø² (${Math.round(score1/MAX_POSSIBLE_SCORE*100)}%) Ø±Ø§ Ú©Ø³Ø¨ Ú©Ø±Ø¯ÛŒØ¯.`;
    } else {
      finalScoreText.innerHTML = `â­ ${p1} ${score1}  -  ${p2} ${score2} â­`;
      totalScoreSummary.innerHTML = `ğŸ“Š Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù…ØªÛŒØ§Ø²Ø§Øª: ${score1+score2} Ø§Ø² Û´Û°Û° Ø§Ù…ØªÛŒØ§Ø² Ù…Ù…Ú©Ù†`;
    }

    const correctCount = playerResults.filter(r => r.isCorrect).length;
    const wrongCount = playerResults.filter(r => !r.isCorrect).length;
    
    let reportHTML = `<div class="report-title">ğŸ“‹ Ú©Ø§Ø±Ù†Ø§Ù…Ù‡ ${p1}</div>
      <div class="report-stats">
        <div class="stat-item"><div>âœ… Ù¾Ø§Ø³Ø® Ø¯Ø±Ø³Øª</div><div class="stat-value">${correctCount}</div></div>
        <div class="stat-item"><div>âŒ Ù¾Ø§Ø³Ø® ØºÙ„Ø·</div><div class="stat-value">${wrongCount}</div></div>
        <div class="stat-item"><div>ğŸ“Š Ø¯Ø±ØµØ¯ Ù…ÙˆÙÙ‚ÛŒØª</div><div class="stat-value">${Math.round((correctCount/20)*100)}%</div></div>
      </div>
      <div class="question-review">`;
    
    playerResults.forEach((r, i) => {
      reportHTML += `<div class="review-item ${r.isCorrect ? 'correct' : 'wrong'}">
        <div><strong>Ø³ÙˆØ§Ù„ ${i+1}:</strong> ${r.question}</div>
        <div>ğŸ”¹ Ù¾Ø§Ø³Ø® Ø´Ù…Ø§: ${r.userAnswer}</div>
        <div>ğŸ”¸ Ù¾Ø§Ø³Ø® ØµØ­ÛŒØ­: ${r.correctAnswer}</div>
        <div style="color:#ffd966; margin-top:5px;">ğŸ’¡ ${r.explanation}</div>
      </div>`;
    });
    reportHTML += `</div>`;
    reportCard.innerHTML = reportHTML;

    medalIcon.innerText = score1 >= 150 ? "ğŸ… Ù¾Ù„Ø§ØªÛŒÙ†" : score1 >= 100 ? "ğŸ¥‡ Ø·Ù„Ø§" : score1 >= 50 ? "ğŸ¥ˆ Ù†Ù‚Ø±Ù‡" : "ğŸ¥‰";

    for (let i=0;i<50;i++) {
      let c = document.createElement('div');
      c.className = 'confetti-particle';
      c.style.left = Math.random()*100 + '%';
      c.style.background = `hsl(${Math.random()*360}, 80%, 60%)`;
      c.style.animationDuration = (1+Math.random()*2)+'s';
      document.body.appendChild(c);
      setTimeout(()=>c.remove(), 2000);
    }
  }

  window.downloadPDF = function() {
    try {
      // Ø§ÛŒØ¬Ø§Ø¯ Ù…Ø­ØªÙˆØ§ÛŒ HTML Ø¨Ø±Ø§ÛŒ PDF
      const reportContent = reportCard.innerHTML;
      
      // Ø§ÛŒØ¬Ø§Ø¯ Ù¾Ù†Ø¬Ø±Ù‡ Ø¬Ø¯ÛŒØ¯ Ø¨Ø±Ø§ÛŒ Ú†Ø§Ù¾/PDF
      const printWindow = window.open('', '_blank');
      printWindow.document.write(`
        <!DOCTYPE html>
        <html dir="rtl">
        <head>
          <meta charset="UTF-8">
          <title>Ú©Ø§Ø±Ù†Ø§Ù…Ù‡ ${p1}</title>
          <style>
            * {
              font-family: 'Vazirmatn', 'Tahoma', sans-serif;
            }
            body {
              padding: 30px;
              background: #f0f0f0;
            }
            .report-card {
              background: white;
              border: 4px solid #ffb700;
              border-radius: 40px;
              padding: 30px;
              max-width: 700px;
              margin: 0 auto;
              box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            }
            .report-title {
              font-size: 28px;
              color: #001d3d;
              text-align: center;
              margin-bottom: 25px;
              font-weight: 900;
            }
            .report-stats {
              display: flex;
              justify-content: space-around;
              background: #f5f5f5;
              padding: 20px;
              border-radius: 30px;
              margin-bottom: 25px;
            }
            .stat-item {
              text-align: center;
            }
            .stat-value {
              font-size: 32px;
              font-weight: bold;
              color: #ffb700;
            }
            .question-review {
              margin-top: 20px;
            }
            .review-item {
              padding: 15px;
              margin: 10px 0;
              border-radius: 15px;
              background: #f9f9f9;
              border-right: 8px solid;
            }
            .correct { border-right-color: #2ecc71; }
            .wrong { border-right-color: #e74c3c; }
            .review-item strong {
              color: #001d3d;
              font-size: 1.1rem;
            }
            .footer {
              text-align: center;
              margin-top: 30px;
              color: #666;
              font-size: 0.9rem;
            }
          </style>
        </head>
        <body>
          ${reportCard.outerHTML}
          <div class="footer">
            <p>ØªØ§Ø±ÛŒØ®: ${new Date().toLocaleDateString('fa-IR')}</p>
          </div>
        </body>
        </html>
      `);
      
      printWindow.document.close();
      
      // Ú©Ù…ÛŒ ØµØ¨Ø± Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ… ØªØ§ Ù…Ø­ØªÙˆØ§ Ù„ÙˆØ¯ Ø´ÙˆØ¯ Ø³Ù¾Ø³ Ú†Ø§Ù¾ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…
      setTimeout(() => {
        printWindow.focus();
        printWindow.print();
      }, 500);
      
    } catch(e) {
      console.error('Ø®Ø·Ø§:', e);
      alert('Ø®Ø·Ø§ Ø¯Ø± Ø§ÛŒØ¬Ø§Ø¯ PDF. Ù„Ø·ÙØ§Ù‹ Ø§Ø² Ø¯Ú©Ù…Ù‡ Ú†Ø§Ù¾ Ù…Ø±ÙˆØ±Ú¯Ø± Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯.');
    }
  };

  window.restartGame = function() {
    stopWarningSound(); // Ù‚Ø·Ø¹ ØµØ¯Ø§ÛŒ Ù‡Ø´Ø¯Ø§Ø±
    resultScreen.classList.add('hidden');
    introScreen.classList.remove('hidden');
    ruleBanner.classList.add('hidden');
    modeDiv.classList.add('hidden');
    launchScreen.classList.add('hidden');
    gameArea.classList.add('hidden');
    nameDialog.classList.add('hidden');
    document.getElementById("countdown").innerText = "Û³";
    
    if (balloon) {
      balloon.classList.remove('balloon-poof');
    }
    
    if (countdownInterval) {
      clearInterval(countdownInterval);
    }
    
    clearTimer();
    score1=0; score2=0; currentIndex=0; turn=1; answerLock=false; gameMode=null; p1=""; p2=""; playerResults=[];
  };
})();
</script>
</div>
</body>
</html>
   